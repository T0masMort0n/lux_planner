Layout Contract Specification — AppShell Left Column Surface Isolation (System-Owned)

This contract is binding for all future UI work in src/lux/ui/qt/* (System Layer owns structure). 
 

AGENT_SCOPES

A) Surface Isolation Rules
Surfaces (system-defined)
Surface	Owner	Must Have	Must NOT Have
System Left Nav (“NavSurface”)	System	Own layout root (dedicated QWidget container) with its own layout instance	Any feature widget parented into its layout subtree
Feature Left Panel (“FeatureLeftSurface”)	System container; feature provides child widget	Separate container inside AppShell (not shared with nav), with exactly one active child at a time	Being a sibling inserted into nav layout, or sharing nav layout
Right Content Surface (“RightContentSurface”)	System container; feature provides child	System-owned container; feature right view swapped independently	Any left panel content
Binding rule

No feature widget may be parented directly to any nav layout. (Feature widgets like JournalLeftPanel(QWidget) are feature-provided content and must mount only into FeatureLeftSurface, never into nav.) 

PROJECT_DUMP

B) Layout Structure Pattern (Required Nesting)

The AppShell left side must follow this nesting exactly:

AppShell (system-owned root)
 ├─ LeftColumnContainer (system-owned)
 │    ├─ NavSurface (system-owned; fixed width region)
 │    └─ FeatureLeftSurface (system-owned; fills remainder)
 └─ RightContentSurface (system-owned)


Notes

LeftColumnContainer is the structural boundary that prevents nav ↔ feature bleed.

NavSurface and FeatureLeftSurface are separate QWidget roots with separate layouts (no shared QVBoxLayout).

C) Containment Guarantees (Non-Negotiable)

Nav width is fixed or policy-bound

Either: fixed pixel width, or fixed via a clearly defined policy constant (system-owned).

Feature left panel must not expand into nav surface

No layout sharing; no stretch factor that reallocates nav width.

Switching features replaces only FeatureLeftSurface child

Feature switching may swap FeatureLeftSurface content without touching nav widget tree.

No global margins applied across both nav + feature

Nav spacing/margins are local to NavSurface layout.

Feature left spacing/margins are local to FeatureLeftSurface layout.

Any “outer” padding belongs to system container(s) individually, never as a wrapper around both.

D) Resize & Stretch Rules
QSizePolicy rules

NavSurface: QSizePolicy.Fixed (or Minimum with an explicit max constraint) in the horizontal axis.

FeatureLeftSurface: QSizePolicy.Expanding (horizontal), Expanding or Preferred (vertical as needed).

RightContentSurface: QSizePolicy.Expanding.

Splitter ownership

If a QSplitter is used:

The splitter is system-owned and lives at the AppShell level (never inside a feature).

Feature widgets must never create or own a splitter that affects system layout regions.

Splitter stretch factors must enforce: nav stable, content flexible.

E) Prohibited Patterns (Explicitly Forbidden)

The following patterns are not allowed and must be rejected in review:

Adding feature widgets to nav layout

Example (forbidden): nav_layout.addWidget(feature_left_panel)

Shared QVBoxLayout for nav + feature

Example (forbidden): one QVBoxLayout holding both nav buttons and feature left panel.

Feature panels setting global margins

Any margins intended to affect nav + feature together are forbidden.

Feature widgets may style themselves internally, but must not assume control of system region spacing.

Feature “reaching upward” into AppShell containers

Features may not take references to nav layouts/containers or mutate them.

Cross-surface parenting

A widget created for FeatureLeft must never be reparented into NavSurface (or vice versa).

Why this is system-critical (admin rationale, formally adopted)

This contract prevents structural drift that would otherwise break or severely complicate future system work (drag/drop hit-zones, explore overlays, animations, resizing stability). 

LUX_SYSTEM_CONTRACTS

 

ARCHITECTURE_NOTES

Review Output (per Systems Designer required format)
1) Architectural impact

Establishes hard surface boundaries inside AppShell, reinforcing the System/Feature separation already defined in architecture and agent scopes. 

PROJECT_ARCHITECTURE (1)

 

AGENT_SCOPES

Makes feature left panels (e.g., JournalLeftPanel(QWidget)) plug-in content only, preventing feature-to-system layout coupling. 

PROJECT_DUMP

2) Boundary violations (if any)

Any existing implementation that mounts feature-left widgets into a nav layout, or uses a shared layout across nav+feature, is a system boundary violation under this spec.

3) Long-term risks

If not enforced, every new feature left panel increases UI debt and creates brittle behavior under resizing and future overlays.

Shared layout trees make later interaction frameworks (drag/drop safe release, explore mode highlighting) harder to reason about and test.

4) Simpler alternatives

Simplest compliant model: no splitter required if nav width is constant and left column is a simple QVBoxLayout with two child containers (NavSurface fixed-height/width + FeatureLeftSurface expanding).

If resizing between left column and right content is needed, keep a single system-owned splitter at AppShell root only.

5) Approval or required revisions

Approved as the binding Layout Contract Specification.

Required revision for any current code that violates “no feature widget inside nav layout” or “no shared layout” is mandatory before further feature UI work proceeds.

6) Required agent sequence

Simplicity Auditor: confirm minimal container count while still meeting the guarantees (no extra wrappers beyond the three surfaces + left column container).

Coder Agent: implement AppShell structure only (no feature redesign). Must comply with: “No AppShell layout changes” applies to features; this is explicitly system work. 

PROJECT_RULES

Systems Review: verify the prohibited patterns are impossible by construction (not just “don’t do it”).

Test Engineer: stress tests for resize + rapid feature swap; confirm nav never shifts and only FeatureLeftSurface child changes. 

AGENT_SCOPES

Documentation Agent: record the contract in /AI_BRAIN/ (and add a short “Do/Don’t” checklist).